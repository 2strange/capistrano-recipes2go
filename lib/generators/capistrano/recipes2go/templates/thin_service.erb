[Unit]
Description=<%= fetch(:thin_daemon_file) %>
After=syslog.target
After=network.target

[Service]
Type=forking

User=<%= fetch(:thin_daemon_user) %>
Group=<%= fetch(:thin_daemon_user) %>

WorkingDirectory=<%= current_path %>
<% if fetch(:thin_daemon_ruby_vm) == :rvm %>
ExecStart=<%= rvm_prefix %> bundle exec thin -C config/thin_app_<%= fetch(:stage) %>.yml start
ExecStop=<%= rvm_prefix %> bundle exec thin -C config/thin_app_<%= fetch(:stage) %>.yml stop
ExecReload=<%= rvm_prefix %> bundle exec thin -C config/thin_app_<%= fetch(:stage) %>.yml restart
<% else %>
ExecStart=/usr/local/bin/bundle exec thin -C config/thin_app_<%= fetch(:stage) %>.yml start
ExecStop=/usr/local/bin/bundle exec thin -C config/thin_app_<%= fetch(:stage) %>.yml stop
ExecReload=/usr/local/bin/bundle exec thin -C config/thin_app_<%= fetch(:stage) %>.yml restart
<% end %>


## build PID-File .. only working method :(
ExecStartPost=/bin/bash -c '/bin/echo $MAINPID > <%= fetch(:thin_pid_path) %>/thin_<%= fetch(:application) %>_<%= fetch(:stage) %>_sysd.pid'
ExecStopPost=/bin/bash -c 'rm <%= fetch(:thin_pid_path) %>/thin_<%= fetch(:application) %>_<%= fetch(:stage) %>_sysd.pid'


TimeoutSec=<%= fetch(:thin_wait) %>
Restart=always

SyslogIdentifier=thin

[Install]
WantedBy=multi-user.target